module.exports = {

"[externals]/ [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js");

module.exports = mod;
}}),
"[externals]/ [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("@opentelemetry/api");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js");

module.exports = mod;
}}),
"[externals]/ [external] (mongoose, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("mongoose");

module.exports = mod;
}}),
"[project]/src/app/lib/utils/SpecialStringsValidator.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "AttendanceValidator": (()=>AttendanceValidator),
    "ExpenseCategoryValidator": (()=>ExpenseCategoryValidator),
    "OrderTypeValidator": (()=>OrderTypeValidator),
    "PaymentModeValidator": (()=>PaymentModeValidator),
    "PaymentStatusValidator": (()=>PaymentStatusValidator),
    "StockStatusValidator": (()=>StockStatusValidator),
    "SubscriptionStatusValidator": (()=>SubscriptionStatusValidator),
    "TableStatusValidator": (()=>TableStatusValidator)
});
function SubscriptionStatusValidator(value) {
    let validation_flag = false;
    var list = [
        "Waiting",
        "On Going",
        "Expired",
        "About to Expire"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function PaymentStatusValidator(value) {
    let validation_flag = false;
    var list = [
        "Paid",
        "Unpaid",
        "Part-Paid"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function PaymentModeValidator(value) {
    let validation_flag = false;
    var list = [
        "Cash",
        "UPI",
        "Credit-Card",
        "Due",
        "Part"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function OrderTypeValidator(value) {
    let validation_flag = false;
    var list = [
        "Takeaway",
        "Delivery",
        "Dine-In",
        "Swiggy",
        "Zomato",
        "QR-Orders"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function TableStatusValidator(value) {
    let validation_flag = false;
    var list = [
        "Booked",
        "Bill Pending",
        "Open"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function StockStatusValidator(value) {
    let validation_flag = false;
    var list = [
        "Available",
        "Low Stock",
        "Unavailable"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function AttendanceValidator(value) {
    let validation_flag = false;
    var list = [
        "Absent",
        "Present",
        "Half-Day"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
function ExpenseCategoryValidator(value) {
    let validation_flag = false;
    var list = [
        "Salary",
        "Purchases",
        "Miscellaneous"
    ];
    list.map((item)=>{
        if (value === item) {
            validation_flag = true;
        }
    });
    return validation_flag;
}
}}),
"[project]/src/app/lib/models/Bills.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "billsSchema": (()=>billsSchema),
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$SpecialStringsValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/SpecialStringsValidator.js [app-route] (ecmascript)");
;
;
const billsSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    Type: {
        type: String,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$SpecialStringsValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["OrderTypeValidator"])(value)
        },
        message: "Bill Type must be one of:- 'Takeaway', 'Delivery', 'Dine-In', 'Swiggy', 'Zomato', 'QR-Orders'."
    },
    TableId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Tables"
    },
    WaiterId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Staffs"
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    },
    CustomerId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Customers"
    },
    VatRate: {
        type: String,
        default: "0 %"
    },
    VatAmount: {
        type: Number,
        default: 0.0
    },
    TotalAmount: {
        type: Number,
        default: 0.0
    },
    CGSTRate: {
        type: String,
        default: "0 %"
    },
    SGSTRate: {
        type: String,
        default: "0 %"
    },
    SGSTAmount: {
        type: Number,
        default: 0.0
    },
    CGSTAmount: {
        type: Number,
        default: 0.0
    },
    EatocoinsRate: {
        type: String,
        default: "0 %"
    },
    EatocoinsAmount: {
        type: Number,
        default: 0.0
    },
    MenuTotal: {
        type: Number,
        default: 0.0
    },
    Amount: {
        type: Number,
        default: 0.0
    },
    BalanceAmount: {
        type: Number,
        default: 0.0
    },
    DeliveryChargesRate: {
        type: String,
        default: "0 %"
    },
    DeliveryChargesAmount: {
        type: Number,
        default: 0.0
    },
    DiscountRate: {
        type: String,
        default: "0 %"
    },
    DiscountPrice: {
        type: Number,
        default: 0.0
    },
    PaymentMode: {
        type: String,
        default: "Cash",
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$SpecialStringsValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PaymentModeValidator"])(value)
        },
        message: "Payment Mode must be one of:- 'Cash', 'UPI', 'Credit-Card', 'Due', 'Part'."
    },
    PaymentStatus: {
        type: String,
        default: "Paid",
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$SpecialStringsValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PaymentStatusValidator"])(value)
        },
        message: "Payment Status must be one of:- 'Paid', 'Unpaid', 'Part-Paid'."
    },
    Status: {
        type: String,
        default: "Open",
        validate: {
            validator: (value)=>{
                [
                    "Open",
                    "Closed"
                ].includes(value);
            }
        },
        message: "Bil Status must be either 'Open' or 'Closed'."
    },
    Orders: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Orders"
        }
    ]
}, {
    timestamps: true
});
// Pre-remove middleware for single document
billsSchema.pre('deleteOne', {
    document: true
}, async function(next) {
    try {
        const Orders = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders');
        // Delete all related orders
        await Orders.deleteMany({
            BillId: this._id
        });
        // Update table status if exists
        if (this.TableId) {
            const Tables = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Tables');
            await Tables.findByIdAndUpdate(this.TableId, {
                Status: "Available"
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
// Pre-deleteMany middleware for multiple documents
billsSchema.pre('deleteMany', async function(next) {
    try {
        const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
        const bills = await Bills.find(this.getFilter());
        if (bills.length > 0) {
            const billIds = bills.map((bill)=>bill._id);
            const tableIds = bills.filter((bill)=>bill.TableId).map((bill)=>bill.TableId);
            // Delete all related orders
            const Orders = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders');
            await Orders.deleteMany({
                BillId: {
                    $in: billIds
                }
            });
            // Update table statuses
            if (tableIds.length > 0) {
                const Tables = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Tables');
                await Tables.updateMany({
                    _id: {
                        $in: tableIds
                    }
                }, {
                    Status: "Available"
                });
            }
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Bills || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Bills", billsSchema);
}}),
"[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "BaseCrud": (()=>BaseCrud)
});
class BaseCrud {
    constructor(model){
        this.model = model;
    }
    // Create a new document
    async create(data) {
        try {
            const doc = new this.model(data);
            await doc.save();
            return {
                returncode: 200,
                message: "Data Created Successfully",
                output: doc
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Read all documents with optional filters
    async readMany(filters = {}, options = {}) {
        try {
            const { sort = {}, populate = [], select = '', skip = 0, limit = 0, lean = false } = options;
            let query = this.model.find(filters);
            // Apply population
            if (populate.length > 0) {
                query = query.populate(populate);
            }
            // Apply sorting
            if (Object.keys(sort).length > 0) {
                query = query.sort(sort);
            }
            // Apply selection
            if (select) {
                query = query.select(select);
            }
            // Apply pagination
            if (skip > 0) {
                query = query.skip(skip);
            }
            if (limit > 0) {
                query = query.limit(limit);
            }
            // Execute query
            const docs = lean ? await query.lean() : await query.exec();
            return {
                returncode: 200,
                message: "Data Fetched Successfully",
                output: docs
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Read a single document
    async readOne(filters = {}, options = {}) {
        try {
            const { populate = [], select = '', lean = false } = options;
            let query = this.model.findOne(filters);
            // Apply population
            if (populate.length > 0) {
                query = query.populate(populate);
            }
            // Apply selection
            if (select) {
                query = query.select(select);
            }
            // Execute query
            const doc = lean ? await query.lean() : await query.exec();
            if (!doc) {
                return {
                    returncode: 404,
                    message: "Document Not Found",
                    output: []
                };
            }
            return {
                returncode: 200,
                message: "Data Fetched Successfully",
                output: doc
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Update a document
    async update(filters = {}, data = {}, options = {
        new: true
    }) {
        try {
            const doc = await this.model.findOneAndUpdate(filters, data, options);
            if (!doc) {
                return {
                    returncode: 404,
                    message: "Document Not Found",
                    output: []
                };
            }
            return {
                returncode: 200,
                message: "Data Updated Successfully",
                output: doc
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Delete a document
    async delete(filters = {}) {
        try {
            console.log('BaseCrud.delete called with:', {
                model: this.model.modelName,
                filters
            });
            const doc = await this.model.deleteMany(filters);
            console.log('BaseCrud.delete result:', doc);
            if (!doc || doc.deletedCount === 0) {
                console.log('BaseCrud.delete - No documents found');
                return {
                    returncode: 404,
                    message: "Document Not Found",
                    output: []
                };
            }
            return {
                returncode: 200,
                message: "Data Deleted Successfully",
                output: doc
            };
        } catch (error) {
            console.error('Error in BaseCrud.delete:', error);
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Check if document exists
    async exists(filters = {}) {
        try {
            const exists = await this.model.exists(filters);
            return {
                returncode: 200,
                message: exists ? "Document Exists" : "Document Not Found",
                output: !!exists
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: false
            };
        }
    }
    // Count documents
    async count(filters = {}) {
        try {
            const count = await this.model.countDocuments(filters);
            return {
                returncode: 200,
                message: "Count Retrieved Successfully",
                output: count
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: 0
            };
        }
    }
}
}}),
"[project]/src/app/lib/utils/StringValidator.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>StringValidators)
});
function StringValidators(value) {
    // Ensure the input is a string
    if (typeof value !== "string") {
        return false;
    }
    if (value === null) {
        return true;
    }
    // List of forbidden characters
    const charList = [
        '/',
        '\\',
        '"',
        ';',
        "'",
        '+',
        '`',
        '^'
    ];
    let validationFlag = true;
    // Iterate over each character in the list
    for (let char of charList){
        // Check if the forbidden character is present in the string
        if (value.includes(char)) {
            validationFlag = false;
            break; // Stop checking further once an invalid character is found
        }
    }
    return validationFlag;
}
}}),
"[project]/src/app/lib/models/Tables.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "tableSchema": (()=>tableSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/StringValidator.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$SpecialStringsValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/SpecialStringsValidator.js [app-route] (ecmascript)");
;
;
;
const tableSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    TableName: {
        type: String,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Table Name should not contain invalid characters like /, \\, \", ;, ', +, `, or ^"
    },
    SectionId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Sections",
        required: true
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    },
    PersonsOccupiable: {
        type: Number,
        default: 4
    },
    Status: {
        type: String,
        default: "Open",
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$SpecialStringsValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TableStatusValidator"])(value)
        },
        message: "Table Status must be one of:- 'Booked', 'Bill Pending', 'Open'."
    },
    // Child Relationship
    Bills: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Bills"
        }
    ]
}, {
    timestamps: true
});
// Add pre-remove middleware
tableSchema.pre('remove', async function(next) {
    try {
        // Check if table has any active bills
        const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
        const activeBills = await Bills.find({
            TableId: this._id,
            Status: 'Open'
        });
        if (activeBills.length > 0) {
            throw new Error('Cannot delete table with active bills');
        }
        // Update completed bills to remove table reference
        await Bills.deleteMany({
            TableId: this._id,
            Status: 'Closed'
        });
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
tableSchema.pre('deleteMany', async function(next) {
    try {
        // Get the tables that will be deleted
        const Tables = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Tables');
        const tables = await Tables.find(this.getFilter());
        const tableIds = tables.map((table)=>table._id);
        // Check for active bills on any table
        const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
        const activeBills = await Bills.find({
            TableId: {
                $in: tableIds
            },
            Status: 'Open'
        });
        if (activeBills.length > 0) {
            throw new Error('Cannot delete tables with active bills');
        }
        // Update completed bills to remove table references
        await Bills.deleteMany({
            TableId: {
                $in: tableIds
            }
        });
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Tables || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Tables", tableSchema);
}}),
"[project]/src/app/lib/utils/BooleanValidator.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>BooleanValidator)
});
function BooleanValidator(value) {
    if (typeof value != "boolean") {
        return false;
    } else {
        return true;
    }
}
}}),
"[project]/src/app/lib/models/GstSettings.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "gstSettingsSchema": (()=>gstSettingsSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$BooleanValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/BooleanValidator.js [app-route] (ecmascript)");
;
;
const gstSettingsSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    Visibility: {
        type: Boolean,
        default: false,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$BooleanValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Visibility should be either true or false"
    },
    GSTPercent: {
        type: Number,
        default: 0.0
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true,
        unique: true
    }
}, {
    timestamps: true
});
// Add pre-remove middleware
gstSettingsSchema.pre('remove', async function(next) {
    try {
        // Update all bills to remove GST references
        const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
        await Bills.updateMany({
            HotelId: this.HotelId
        }, {
            $set: {
                CGSTRate: '0 %',
                SGSTRate: '0 %',
                CGSTAmount: 0,
                SGSTAmount: 0
            }
        });
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
gstSettingsSchema.pre('deleteMany', async function(next) {
    try {
        // Get the settings that will be deleted
        const GstSettings = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('GstSettings');
        const settings = await GstSettings.find(this.getFilter());
        const hotelIds = settings.map((setting)=>setting.HotelId);
        if (hotelIds.length > 0) {
            // Update all bills to remove GST references
            const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
            await Bills.updateMany({
                HotelId: {
                    $in: hotelIds
                }
            }, {
                $set: {
                    CGSTRate: '0 %',
                    SGSTRate: '0 %',
                    CGSTAmount: 0,
                    SGSTAmount: 0
                }
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.GstSettings || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("GstSettings", gstSettingsSchema);
}}),
"[project]/src/app/lib/crud/GSTSettings.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$GstSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/GstSettings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
;
;
class GSTSettingsCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$GstSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async addSettings(data) {
        try {
            const normalizedData = {
                Visibility: data.visibility,
                GSTPercent: data.gst_percent,
                HotelId: data.hotel_id
            };
            const result = await this.create(normalizedData);
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readSettings(hotel_id) {
        try {
            const result = await this.readOne({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readAllSettings(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateSettings(data) {
        try {
            const updateData = {
                Visibility: data.visibility,
                GSTPercent: data.gst_percent
            };
            const hotel_id = data.hotel_id;
            const result = await this.update({
                HotelId: hotel_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteSettings(hotel_id) {
        try {
            const result = await this.delete({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const gstSettingsCrud = new GSTSettingsCrud();
const __TURBOPACK__default__export__ = gstSettingsCrud;
}}),
"[project]/src/app/lib/models/VatSettings.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "vatSettingsSchema": (()=>vatSettingsSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$BooleanValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/BooleanValidator.js [app-route] (ecmascript)");
;
;
const vatSettingsSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    Visibility: {
        type: Boolean,
        default: false,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$BooleanValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Visibility should be either true or false"
    },
    VATPercent: {
        type: Number,
        default: 0.0
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true,
        unique: true
    }
}, {
    timestamps: true
});
// Add pre-remove middleware
vatSettingsSchema.pre('remove', async function(next) {
    try {
        // Update all bills to remove VAT references
        const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
        await Bills.updateMany({
            HotelId: this.HotelId
        }, {
            $set: {
                VatRate: '0 %',
                VatAmount: 0
            }
        });
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
vatSettingsSchema.pre('deleteMany', async function(next) {
    try {
        // Get the settings that will be deleted
        const VatSettings = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('VatSettings');
        const settings = await VatSettings.find(this.getFilter());
        const hotelIds = settings.map((setting)=>setting.HotelId);
        if (hotelIds.length > 0) {
            // Update all bills to remove VAT references
            const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
            await Bills.updateMany({
                HotelId: {
                    $in: hotelIds
                }
            }, {
                $set: {
                    VatRate: '0 %',
                    VatAmount: 0
                }
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.VatSettings || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("VatSettings", vatSettingsSchema);
}}),
"[project]/src/app/lib/crud/VATSettings.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$VatSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/VatSettings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
;
;
class VATSettingsCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$VatSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async addSettings(data) {
        try {
            const normalizedData = {
                Visibility: data.visibility,
                VATPercent: data.vat_percent,
                HotelId: data.hotel_id
            };
            const result = this.create(normalizedData);
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readSettings(hotel_id) {
        try {
            const result = this.readOne({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readAllSettings(hotel_id) {
        try {
            const result = this.readMany({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateSettings(data) {
        try {
            const updateData = {
                Visibility: data.visibility,
                VATPercent: data.vat_percent
            };
            const hotel_id = data.hotel_id;
            const result = this.update({
                HotelId: hotel_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteSettings(hotel_id) {
        try {
            const result = this.delete({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const vatSettingsCrud = new VATSettingsCrud();
const __TURBOPACK__default__export__ = vatSettingsCrud;
}}),
"[project]/src/app/lib/models/EatoCoinsSettings.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "eatocoinsSettingsSchema": (()=>eatocoinsSettingsSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$BooleanValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/BooleanValidator.js [app-route] (ecmascript)");
;
;
const eatocoinsSettingsSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    Visibility: {
        type: Boolean,
        default: false,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$BooleanValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Visibility should be either true or false"
    },
    CreditLimitAmt: {
        type: Number,
        default: 0
    },
    CreditLimitPercent: {
        type: Number,
        default: 0
    },
    RedeemLimitAmount: {
        type: Number,
        default: 0
    },
    RedeemLimitPercent: {
        type: Number,
        default: 0
    },
    Rate: {
        type: Number,
        default: 0
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true,
        unique: true
    }
}, {
    timestamps: true
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.EatocoinsSettings || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("EatocoinsSettings", eatocoinsSettingsSchema);
}}),
"[project]/src/app/lib/crud/EatocoinsSettings.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$EatoCoinsSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/EatoCoinsSettings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
;
;
class EatocoinsSettingsCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$EatoCoinsSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async addSettings(data) {
        try {
            const normalizedData = {
                Visibility: data.visibility,
                CreditLimitAmt: data.credit_limit_amt,
                CreditLimitPercent: data.credit_limit_percent,
                RedeemLimitAmount: data.redeem_limit_amt,
                RedeemLimitPercent: data.redeem_limit_percent,
                Rate: data.rate,
                HotelId: data.hotel_id
            };
            const result = await this.create(normalizedData);
            return result;
        } catch (error) {
            console.error('Error in addSettings:', error);
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readSettings(hotel_id) {
        try {
            const result = await this.readOne({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            console.error('Error in readSettings:', error);
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readAllSettings(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateSettings(data) {
        try {
            const updateData = {
                Visibility: data.visibility,
                CreditLimitAmt: data.credit_limit_amt,
                CreditLimitPercent: data.credit_limit_percent,
                RedeemLimitAmount: data.redeem_limit_amt,
                RedeemLimitPercent: data.redeem_limit_percent,
                Rate: data.rate
            };
            const result = await this.update({
                HotelId: data.hotel_id
            }, updateData);
            return result;
        } catch (error) {
            console.error('Error in updateSettings:', error);
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteSettings(hotel_id) {
        try {
            const result = await this.delete({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            console.error('Error in deleteSettings:', error);
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const eatocoinsSettingsCrud = new EatocoinsSettingsCrud();
const __TURBOPACK__default__export__ = eatocoinsSettingsCrud;
}}),
"[project]/src/app/lib/models/Reservation.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "ReservationSchema": (()=>ReservationSchema),
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
;
const ReservationSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    Date: {
        type: String,
        required: true
    },
    Time: {
        type: String,
        required: true
    },
    Note: {
        type: String,
        default: null
    },
    NoOfPersons: {
        type: Number,
        default: 0
    },
    CustomerId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Customers",
        required: true
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    }
}, {
    timestamps: true
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Reservations;
}}),
"[project]/src/app/lib/models/Customers.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "customerSchema": (()=>customerSchema),
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/StringValidator.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Reservation$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Reservation.js [app-route] (ecmascript)");
;
;
;
const customerSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    CustomerName: {
        type: String,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Customer Name should not contain invalid characters like /, \\, \", ;, ', +, `, or ^"
    },
    Contact: {
        type: String,
        required: false
    },
    Email: {
        type: String,
        required: false
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    },
    EatocoinsWallet: {
        type: Number,
        default: 0
    },
    StreetAddress: {
        type: String,
        required: false
    },
    Apartment: {
        type: String,
        required: false
    },
    City: {
        type: String,
        required: false
    },
    State: {
        type: String,
        required: false
    },
    Landmark: {
        type: String,
        required: false
    },
    ZipCode: {
        type: String,
        required: false
    },
    Birthday: {
        type: String,
        required: false
    },
    Anniversary: {
        type: String,
        required: false
    },
    // Child Relationship
    Bills: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Bills"
        }
    ],
    Reservation: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Reservations"
        }
    ]
}, {
    timestamps: true
});
// Add pre-remove middleware
customerSchema.pre('remove', async function(next) {
    try {
        // Check for active bills
        const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
        const activeBills = await Bills.find({
            CustomerId: this._id,
            Status: 'Open'
        });
        if (activeBills.length > 0) {
            throw new Error('Cannot delete customer with active bills');
        }
        // Update completed bills to remove customer reference
        await Bills.deleteMany({
            CustomerId: this._id
        });
        // Delete any reservations
        const Reservation = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Reservations');
        await Reservation.deleteMany({
            CustomerId: this._id
        });
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
customerSchema.pre('deleteMany', async function(next) {
    try {
        // Get customers to be deleted
        const Customers = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Customers');
        const customers = await Customers.find(this.getFilter());
        const customerIds = customers.map((customer)=>customer._id);
        if (customerIds.length > 0) {
            // Check for active bills
            const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
            const activeBills = await Bills.find({
                CustomerId: {
                    $in: customerIds
                },
                Status: 'Open'
            });
            if (activeBills.length > 0) {
                throw new Error('Cannot delete customers with active bills');
            }
            // Update completed bills and delete reservations in parallel
            await Promise.all([
                Bills.deleteMany({
                    CustomerId: {
                        $in: customerIds
                    }
                }),
                __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Reservation$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].deleteMany({
                    CustomerId: {
                        $in: customerIds
                    }
                })
            ]);
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Customers || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Customers", customerSchema);
}}),
"[project]/src/app/lib/crud/Customers.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Customers.js [app-route] (ecmascript)");
;
;
class CustomersCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async createCustomerBackup({ customer_id = null, customer_name, email, contact, hotel_id, street_address, apartment, city, state, landmark, zip_code, birthday, anniversary }) {
        try {
            const normalizedData = {
                CustomerName: customer_name,
                Email: email || null,
                Contact: contact,
                HotelId: hotel_id,
                // Detailed address fields
                StreetAddress: street_address || null,
                Apartment: apartment || null,
                City: city || null,
                State: state || null,
                Landmark: landmark || null,
                ZipCode: zip_code || null,
                Birthday: birthday || null,
                Anniversary: anniversary || null
            };
            const exists = await this.readOne({
                CustomerName: customer_name,
                Contact: contact,
                HotelId: hotel_id
            });
            customer_id = exists.output._id;
            if (exists.output.length > 0) {
                const updateData = {
                    CustomerName: customer_name,
                    Email: email || null,
                    Contact: contact,
                    StreetAddress: street_address || null,
                    Apartment: apartment || null,
                    City: city || null,
                    State: state || null,
                    Landmark: landmark || null,
                    ZipCode: zip_code || null,
                    Birthday: birthday || null,
                    Anniversary: anniversary || null
                };
                return await this.update(updateData);
            }
            return await this.create(normalizedData);
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async createCustomer(data) {
        try {
            const normalizedData = {
                CustomerName: data.customer_name,
                Email: data.email,
                Contact: data.contact,
                HotelId: data.hotel_id,
                // Detailed address fields
                StreetAddress: data.street_address || null,
                Apartment: data.apartment || null,
                City: data.city || null,
                State: data.state || null,
                Landmark: data.landmark || null,
                ZipCode: data.zip_code || null,
                Birthday: data.birthday || null,
                Anniversary: data.anniversary || null
            };
            const result = await this.create(normalizedData);
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readCustomers(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readCustomerDetails(customer_id) {
        try {
            const result = await this.readOne({
                _id: customer_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async checkCustomer(customer_name, contact, hotel_id) {
        try {
            const result = await this.readOne({
                CustomerName: customer_name,
                Contact: contact,
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateCustomerInfo(data) {
        try {
            const updateData = {
                CustomerName: data.name,
                Email: data.email,
                Contact: data.contact,
                StreetAddress: data.street_address,
                Apartment: data.apartment,
                City: data.city,
                State: data.state,
                Landmark: data.landmark,
                ZipCode: data.zip_code,
                Birthday: data.birthday,
                Anniversary: data.anniversary
            };
            const result = await this.update({
                _id: data.customer_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateWallet(data) {
        try {
            const customer = await this.readOne({
                _id: data.customer_id
            });
            if (customer.returncode !== 200) {
                return customer;
            }
            const updateData = {
                EatocoinsWallet: data.wallet
            };
            const result = await this.update({
                _id: data.customer_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteCustomers(filter) {
        try {
            // Check if any customers have open bills
            const customers = await this.readMany(filter);
            if (customers.returncode === 200) {
                // If no open bills, proceed with deletion
                const result = await this.delete(filter);
                return result;
            }
            return {
                returncode: 200,
                message: "No Customers Found.",
                output: []
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async doesCustomerExist(hotel_id, email) {
        try {
            const result = await this.readOne({
                HotelId: hotel_id,
                Email: email
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const customersCrud = new CustomersCrud();
const __TURBOPACK__default__export__ = customersCrud;
}}),
"[project]/src/app/lib/crud/Bills.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Bills.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Tables.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$GSTSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/GSTSettings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$VATSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/VATSettings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$EatocoinsSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/EatocoinsSettings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Customers.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
class BillsCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async createBill(data) {
        try {
            const normalizedData = {
                Type: data.type,
                TableId: data.table_id,
                WaiterId: data.waiter_id,
                HotelId: data.hotel_id,
                CustomerId: data.customer_id
            };
            // Create the bill
            const result = await this.create(normalizedData);
            if (result.returncode === 200) {
                // If table is assigned, update its status
                if (data.table_id) {
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(data.table_id, {
                        Status: "Booked"
                    }, {
                        new: true
                    });
                }
            }
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readBills(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            }, {
                populate: [
                    {
                        path: 'Orders',
                        populate: [
                            {
                                path: 'MenuId',
                                select: 'Price',
                                populate: {
                                    path: 'DishId',
                                    select: 'DishName Description Type'
                                }
                            }
                        ]
                    },
                    {
                        path: 'TableId',
                        select: 'TableName Capacity Status'
                    },
                    {
                        path: 'WaiterId',
                        select: 'FirstName LastName Role'
                    },
                    {
                        path: 'CustomerId',
                        select: 'CustomerName Contact Email'
                    },
                    {
                        path: 'HotelId',
                        select: 'HotelName'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readBills(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            }, {
                populate: [
                    {
                        path: 'Orders',
                        populate: [
                            {
                                path: 'MenuId',
                                select: 'Price',
                                populate: {
                                    path: 'DishId',
                                    select: 'DishName Description Type'
                                }
                            }
                        ]
                    },
                    {
                        path: 'TableId',
                        select: 'TableName Capacity Status'
                    },
                    {
                        path: 'WaiterId',
                        select: 'FirstName LastName Role'
                    },
                    {
                        path: 'CustomerId',
                        select: 'CustomerName Contact Email'
                    },
                    {
                        path: 'HotelId',
                        select: 'HotelName'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readBillByStaffId(staff_id) {
        try {
            const result = await this.readOne({
                WaiterId: staff_id
            }, {
                populate: [
                    {
                        path: 'Orders',
                        populate: [
                            {
                                path: 'MenuId',
                                select: 'Price',
                                populate: {
                                    path: 'DishId',
                                    select: 'DishName Description Type'
                                }
                            }
                        ]
                    },
                    {
                        path: 'TableId',
                        select: 'TableName Capacity Status'
                    },
                    {
                        path: 'WaiterId',
                        select: 'FirstName LastName Role'
                    },
                    {
                        path: 'CustomerId',
                        select: 'Name Contact Email'
                    },
                    {
                        path: 'HotelId',
                        select: 'HotelName'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readBill(bill_id) {
        try {
            const result = await this.readOne({
                _id: bill_id
            }, {
                populate: [
                    {
                        path: 'Orders',
                        populate: [
                            {
                                path: 'MenuId',
                                select: 'Price',
                                populate: {
                                    path: 'DishId',
                                    select: 'DishName Description Type'
                                }
                            }
                        ]
                    },
                    {
                        path: 'TableId',
                        select: 'TableName Capacity Status'
                    },
                    {
                        path: 'WaiterId',
                        select: 'FirstName LastName Role'
                    },
                    {
                        path: 'CustomerId',
                        select: 'Name Contact Email'
                    },
                    {
                        path: 'HotelId',
                        select: 'HotelName'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async kotRead(bill_id) {
        try {
            const result = await this.readOne({
                _id: bill_id
            }, {
                populate: [
                    {
                        path: 'Orders',
                        match: {
                            Status: 'Ordered'
                        },
                        populate: [
                            {
                                path: 'MenuId',
                                select: 'Price',
                                populate: {
                                    path: 'DishId',
                                    select: 'DishName Description Type'
                                }
                            }
                        ]
                    },
                    {
                        path: 'TableId',
                        select: 'TableName Capacity Status'
                    },
                    {
                        path: 'WaiterId',
                        select: 'FirstName LastName Role'
                    },
                    {
                        path: 'CustomerId',
                        select: 'Name Contact Email'
                    },
                    {
                        path: 'HotelId',
                        select: 'HotelName'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async dineInRead(table_id) {
        try {
            const result = await this.readOne({
                TableId: table_id,
                Status: "Open"
            }, {
                populate: [
                    {
                        path: 'Orders',
                        populate: [
                            {
                                path: 'MenuId',
                                select: 'Price',
                                populate: {
                                    path: 'DishId',
                                    select: 'DishName Description Type'
                                }
                            }
                        ]
                    },
                    {
                        path: 'TableId',
                        select: 'TableName Capacity Status'
                    },
                    {
                        path: 'WaiterId',
                        select: 'FirstName LastName Role'
                    },
                    {
                        path: 'CustomerId',
                        select: 'Name Contact Email'
                    },
                    {
                        path: 'HotelId',
                        select: 'HotelName'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async AssignWaiter(data) {
        try {
            const updateData = {
                WaiterId: data.waiter_id
            };
            const bill_id = data.bill_id;
            const result = await this.update({
                _id: bill_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async AssignTable(data) {
        try {
            // First check if table is available
            const table = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findById(data.table_id);
            if (!table || table.Status !== "Available") {
                return {
                    returncode: 400,
                    message: "Table is not available",
                    output: []
                };
            }
            const updateData = {
                TableId: data.table_id
            };
            const bill_id = data.bill_id;
            // Update bill with table
            const result = await this.update({
                _id: bill_id
            }, updateData, {
                new: true
            });
            if (result.returncode === 200) {
                // Update table status
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(data.table_id, {
                    Status: "Open"
                }, {
                    new: true
                });
            }
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async UpdateCustomer(data) {
        try {
            const updateData = {
                CustomerId: data.customer_id
            };
            const bill_id = data.bill_id;
            const result = await this.update({
                _id: bill_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteBillById(bill_id) {
        try {
            const bill = await this.readOne({
                _id: bill_id
            });
            if (bill.returncode === 200) {
                // Finally delete the bill
                const result = await this.delete({
                    _id: bill_id
                });
                return result;
            }
            return {
                returncode: 200,
                message: "Bill and related data deleted successfully",
                output: []
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteBills(filter) {
        try {
            // Get bills to be deleted
            const billsToDelete = await this.readMany(filter);
            if (billsToDelete.returncode === 200 && billsToDelete.output.length > 0) {
                // Finally delete all bills
                const result = await this.delete(filter);
                return result;
            }
            return {
                returncode: 200,
                message: "No bills found to delete",
                output: []
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async addOrderToBill(bill_id, order_id) {
        try {
            const result = await this.update({
                _id: bill_id
            }, {
                $push: {
                    Orders: order_id
                }
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async removeOrderFromBill(bill_id, order_id) {
        try {
            const result = await this.update({
                _id: bill_id
            }, {
                $pull: {
                    Orders: order_id
                }
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async BillPayment({ bill_id, payment_mode, payment_status, balance_amount, eatocoins, delivery_rate, delivery_amount, discount_rate, discount_amount, hotel_id }) {
        try {
            const bill = await this.readOne({
                _id: bill_id
            }, {
                populate: [
                    {
                        path: 'Orders',
                        match: {
                            Status: 'Ordered'
                        },
                        populate: {
                            path: 'MenuId',
                            select: 'Price'
                        }
                    }
                ]
            });
            if (bill.returncode !== 200) {
                return bill;
            }
            const customer_id = bill.output.CustomerId;
            let menu_total = 0;
            // Calculate menu total
            if (bill.output.Orders) {
                menu_total = bill.output.Orders.reduce((total, order)=>{
                    return total + (order.MenuId ? order.MenuId.Price * order.Quantity : 0);
                }, 0);
            }
            // GST Params
            let gst_amount = 0;
            let cgst_rate = 0;
            let sgst_rate = 0;
            let cgst_amount = 0;
            let sgst_amount = 0;
            const gstSettings = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$GSTSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readSettings(hotel_id);
            if (gstSettings.output?.Visibility) {
                gst_amount = menu_total * gstSettings.output.GSTPercent / 100;
                cgst_amount = gst_amount / 2 | 0;
                sgst_amount = gst_amount / 2 | 0;
                cgst_rate = gstSettings.output.GSTPercent / 2;
                sgst_rate = cgst_rate;
            }
            // Vat Params
            let vat_rate = 0;
            let vat_amount = 0;
            const vatSettings = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$VATSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readSettings(hotel_id);
            if (vatSettings.output?.Visibility) {
                vat_rate = gstSettings.output.GSTPercent;
                vat_amount = menu_total * vat_rate / 100;
            }
            // Delivery Params
            if (delivery_rate != 0) {
                delivery_amount = delivery_rate / 100 * menu_total;
            }
            // Total amount
            const total_amount = menu_total + cgst_amount + sgst_amount + vat_amount + delivery_amount;
            // Discount
            if (discount_rate != 0) {
                discount_amount = discount_rate / 100 * total_amount | 0;
            }
            // Calculating amount of bill
            let amount = total_amount - discount_amount;
            // Eatocoins Params 
            let eatocoins_rate = 0;
            let credit_eatocoins = 0;
            const eatocoinsSettings = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$EatocoinsSettings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readSettings(hotel_id);
            if (eatocoinsSettings.output?.Visibility) {
                eatocoins_rate = eatocoinsSettings.output.RedeemLimitPercent || 0;
                let redeem_limit_amt = eatocoinsSettings.output.RedeemLimitAmount || 0;
                let credit_limit_amt = eatocoinsSettings.output.CreditLimitAmt || 0;
                let credit_limit_rate = eatocoinsSettings.output.CreditLimitPercent || 0;
                // Check whether Amount is greater than Credit Limit 
                if (amount >= credit_limit_amt) {
                    credit_eatocoins = credit_limit_rate / 100 * total_amount | 0;
                }
                // Redeem
                if (eatocoins != 0) {
                    if (eatocoins_rate != 0) {
                        // Redeem limit
                        if (amount >= redeem_limit_amt) {
                            // Max Amount
                            const eatocoins_max = eatocoins_rate / 100 * total_amount | 0;
                            // If Eatocoins in input is greater than max amount
                            if (eatocoins > eatocoins_max) {
                                eatocoins = eatocoins_max;
                            }
                        } else {
                            eatocoins = 0;
                            eatocoins_rate = 0;
                        }
                    }
                } else {
                    eatocoins = 0;
                    eatocoins_rate = 0;
                }
            }
            // Update bill with calculated amounts
            const updateData = {
                MenuTotal: menu_total,
                VatAmount: vat_amount,
                CGSTAmount: cgst_amount,
                SGSTAmount: sgst_amount,
                DeliveryChargesAmount: delivery_amount,
                DiscountAmount: discount_amount,
                EatocoinsAmount: eatocoins,
                DeliveryChargesRate: `${delivery_rate} %`,
                DiscountRate: `${discount_rate} %`,
                CGSTRate: `${cgst_rate} %`,
                SGSTRate: `${sgst_rate} %`,
                VatRate: `${vat_rate} %`,
                EatocoinsRate: `${eatocoins_rate} %`,
                TotalAmount: total_amount,
                Amount: amount,
                BalanceAmount: balance_amount,
                PaymentMode: payment_mode,
                PaymentStatus: payment_status,
                Status: "Closed"
            };
            const result = await this.update({
                _id: bill_id
            }, updateData, {
                new: true
            });
            if (result.returncode === 200) {
                if (customer_id != null) {
                    const customer_info = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readCustomerDetails(customer_id);
                    const eato_wallet = customer_info.output.EatocoinsWallet;
                    console.log('Wallet update data:', {
                        customer_id,
                        eato_wallet,
                        credit_eatocoins,
                        eatocoins
                    });
                    if (eato_wallet > eatocoins) {
                        credit_eatocoins = eato_wallet - eatocoins + credit_eatocoins;
                        const data = {
                            customer_id,
                            wallet: credit_eatocoins
                        };
                        await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].updateWallet(data);
                    } else if (credit_eatocoins > 0) {
                        credit_eatocoins = eato_wallet + credit_eatocoins;
                        const data = {
                            customer_id,
                            wallet: credit_eatocoins
                        };
                        await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].updateWallet(data);
                    }
                }
            }
            // Table Status
            if (result.output.TableId) {
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(result.output.TableId, {
                    Status: "Open"
                }, {
                    new: true
                });
            }
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async splitBill(bill_id, split_data) {
        try {
            const originalBill = await this.readOne({
                _id: bill_id
            });
            if (originalBill.returncode !== 200) {
                return originalBill;
            }
            // Create new bills
            const newBills = [];
            for (const splitInfo of split_data){
                const newBillData = {
                    Type: originalBill.output.Type,
                    TableId: originalBill.output.TableId,
                    WaiterId: originalBill.output.WaiterId,
                    HotelId: originalBill.output.HotelId,
                    CustomerId: splitInfo.customer_id || originalBill.output.CustomerId,
                    Orders: splitInfo.order_ids
                };
                const newBill = await this.create(newBillData);
                if (newBill.returncode === 200) {
                    newBills.push(newBill.output);
                } else {
                    // Rollback created bills if any creation fails
                    for (const bill of newBills){
                        await this.delete({
                            _id: bill._id
                        });
                    }
                    return newBill;
                }
            }
            // Remove split orders from original bill
            const allSplitOrderIds = split_data.reduce((acc, split)=>[
                    ...acc,
                    ...split.order_ids
                ], []);
            await this.update({
                _id: bill_id
            }, {
                $pull: {
                    Orders: {
                        $in: allSplitOrderIds
                    }
                }
            }, {
                new: true
            });
            // Recalculate all bills
            await this.calculateBillTotal(bill_id);
            for (const bill of newBills){
                await this.calculateBillTotal(bill._id);
            }
            return {
                returncode: 200,
                message: "Bill split successfully",
                output: {
                    originalBill: bill_id,
                    newBills: newBills.map((b)=>b._id)
                }
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async SyncBills({ Type, TableId, WaiterId, HotelId, CustomerId, Customers, Orders = [], createdAt, updatedAt, MenuTotal, VatAmount, CGSTAmount, SGSTAmount, DeliveryChargesAmount, DiscountAmount, EatocoinsAmount, DeliveryChargesRate, DiscountRate, CGSTRate, SGSTRate, VatRate, EatocoinsRate, TotalAmount, Amount, BalanceAmount, PaymentMode, PaymentStatus, Status }) {
        try {
            if (WaiterId === "") {
                WaiterId = null;
            }
            let bill;
            if (CustomerId !== null) {
                const customerData = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Customers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].create({
                    CustomerName: Customers.CustomerName,
                    Email: Customers.Email,
                    Contact: Customers.Contact,
                    HotelId: Customers.HotelId,
                    StreetAddress: Customers.StreetAddress,
                    Apartment: Customers.Apartment,
                    City: Customers.City,
                    State: Customers.State,
                    Landmark: Customers.Landmark,
                    ZipCode: Customers.ZipCode,
                    Birthday: Customers.Birthday,
                    Anniversary: Customers.Anniversary
                });
                const customer_id = customerData.output._id;
                bill = await this.create({
                    Type,
                    TableId,
                    WaiterId,
                    HotelId,
                    CustomerId: customer_id,
                    createdAt,
                    updatedAt,
                    MenuTotal,
                    VatAmount,
                    CGSTAmount,
                    SGSTAmount,
                    DeliveryChargesAmount,
                    DiscountAmount,
                    EatocoinsAmount,
                    DeliveryChargesRate,
                    DiscountRate,
                    CGSTRate,
                    SGSTRate,
                    VatRate,
                    EatocoinsRate,
                    TotalAmount,
                    Amount,
                    BalanceAmount,
                    PaymentMode,
                    PaymentStatus,
                    Status
                });
            } else {
                bill = await this.create({
                    Type,
                    TableId,
                    WaiterId,
                    HotelId,
                    CustomerId,
                    createdAt,
                    updatedAt,
                    MenuTotal,
                    VatAmount,
                    CGSTAmount,
                    SGSTAmount,
                    DeliveryChargesAmount,
                    DiscountAmount,
                    EatocoinsAmount,
                    DeliveryChargesRate,
                    DiscountRate,
                    CGSTRate,
                    SGSTRate,
                    VatRate,
                    EatocoinsRate,
                    TotalAmount,
                    Amount,
                    BalanceAmount,
                    PaymentMode,
                    PaymentStatus,
                    Status
                });
            }
            console.log(bill);
            const bill_id = bill.output._id;
            Orders.map(async (Order)=>{
                const Data = {
                    Quantity: Order.Quantity,
                    Note: Order.Note,
                    TotalAmount: Order.TotalAmount,
                    MenuId: Order.MenuId._id,
                    bill_id,
                    Status: Order.Status,
                    HotelId: Order.HotelId
                };
                await ordersCrud.SyncOrder(Data);
            });
            return await this.readOne({
                _id: bill_id
            });
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const billsCrud = new BillsCrud();
const __TURBOPACK__default__export__ = billsCrud;
}}),
"[project]/src/app/lib/models/MenuCategory.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "menuCategorySchema": (()=>menuCategorySchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/StringValidator.js [app-route] (ecmascript)");
;
;
const menuCategorySchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    CategoryName: {
        type: String,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Category Name should not contain invalid characters like /, \\, \", ;, ', +, `, or ^"
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    },
    // Child Relationship
    Dishes: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Dishes"
        }
    ]
}, {
    timestamps: true
});
// Unique constraint on HotelId and CategoryName
menuCategorySchema.index({
    HotelId: 1,
    CategoryName: 1
}, {
    unique: true
});
// Add pre-remove middleware
menuCategorySchema.pre('remove', async function(next) {
    try {
        // Check if dish has any active menus
        const Dishes = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Dishes');
        const activeDishes = await Dishes.find({
            CategoryId: this._id
        });
        if (activeDishes.length > 0) {
            // Delete all related menus first
            await Dishes.deleteMany({
                CategoryId: this._id
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
menuCategorySchema.pre('deleteMany', async function(next) {
    try {
        // Get the dishes that will be deleted
        const Categories = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('MenuCategory');
        const categories = await Categories.find(this.getFilter());
        const Ids = categories.map((category)=>category._id);
        // Delete all related menus
        if (Ids.length > 0) {
            const Dishes = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Dishes');
            await Dishes.deleteMany({
                CategoryId: {
                    $in: Ids
                }
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.MenuCategory;
}}),
"[project]/src/app/lib/models/Dishes.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "dishesSchema": (()=>dishesSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/StringValidator.js [app-route] (ecmascript)");
;
;
const dishesSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    DishName: {
        type: String,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Dish Name should not contain invalid characters like /, \\, \", ;, ', +, `, or ^"
    },
    Code: {
        type: String,
        required: true
    },
    Description: {
        type: String,
        default: null
    },
    Type: {
        type: String,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$StringValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Dish Type should not contain invalid characters like /, \\, \", ;, ', +, `, or ^"
    },
    CategoryId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "MenuCategory",
        required: true
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    },
    // Child Relationship
    Menus: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Menus"
        }
    ]
}, {
    timestamps: true
});
// Unique constraint on HotelId and Code
dishesSchema.index({
    HotelId: 1,
    Code: 1
}, {
    unique: true
});
// Add pre-remove middleware
dishesSchema.pre('remove', async function(next) {
    try {
        const Menus = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Menus');
        const Orders = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders');
        // Check if dish has any active orders
        const activeOrders = await Orders.find({
            'Items.DishId': this._id,
            Status: {
                $in: [
                    'Pending',
                    'Processing',
                    'Ready'
                ]
            }
        });
        if (activeOrders.length > 0) {
            throw new Error('Cannot delete dish with active orders');
        }
        // Delete all related menus
        await Menus.deleteMany({
            DishId: this._id
        });
        // Update completed orders to mark deleted dishes
        await Orders.updateMany({
            'Items.DishId': this._id,
            Status: 'Completed'
        }, {
            $set: {
                'Items.$[elem].Deleted': true
            }
        }, {
            arrayFilters: [
                {
                    'elem.DishId': this._id
                }
            ]
        });
        // Remove from MenuCategory's Dishes array
        const MenuCategory = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('MenuCategory');
        await MenuCategory.updateMany({
            Dishes: this._id
        }, {
            $pull: {
                Dishes: this._id
            }
        });
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
dishesSchema.pre('deleteMany', async function(next) {
    try {
        const Dishes = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Dishes');
        const dishes = await Dishes.find(this.getFilter());
        const dishIds = dishes.map((dish)=>dish._id);
        if (dishIds.length > 0) {
            const [Orders, Menus, MenuCategory] = await Promise.all([
                __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders'),
                __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Menus'),
                __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('MenuCategory')
            ]);
            // Check for active orders
            const activeOrders = await Orders.find({
                'Items.DishId': {
                    $in: dishIds
                },
                Status: {
                    $in: [
                        'Pending',
                        'Processing',
                        'Ready'
                    ]
                }
            });
            if (activeOrders.length > 0) {
                throw new Error('Cannot delete dishes with active orders');
            }
            // Run cleanup operations in parallel
            await Promise.all([
                // Delete related menus
                Menus.deleteMany({
                    DishId: {
                        $in: dishIds
                    }
                }),
                // Update completed orders
                Orders.updateMany({
                    'Items.DishId': {
                        $in: dishIds
                    },
                    Status: 'Completed'
                }, {
                    $unset: {
                        ItemId: 1
                    }
                }),
                // Remove from MenuCategory's Dishes arrays
                MenuCategory.updateMany({
                    Dishes: {
                        $in: dishIds
                    }
                }, {
                    $pull: {
                        Dishes: {
                            $in: dishIds
                        }
                    }
                })
            ]);
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Dishes || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Dishes", dishesSchema);
}}),
"[project]/src/app/lib/utils/FloatValidator.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>FloatValidator)
});
function FloatValidator(value) {
    // First convert to number if it's a string
    const num = typeof value === 'string' ? Number(value) : value;
    // Check if it's a valid number and greater than 0
    return !isNaN(num) && num > 0;
}
}}),
"[project]/src/app/lib/models/Menus.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "menusSchema": (()=>menusSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$FloatValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/FloatValidator.js [app-route] (ecmascript)");
;
;
const menusSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    },
    SectionId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Sections",
        required: true
    },
    DishId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Dishes",
        required: true
    },
    Price: {
        type: Number,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$FloatValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Price must be a non-negative number and must be in decimal format(100.00)."
    },
    // Child Relationship
    Menu: [
        {
            type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
            ref: "Orders"
        }
    ]
}, {
    timestamps: true
});
// Unique constraint on SectionId and DishId
menusSchema.index({
    SectionId: 1,
    DishId: 1
}, {
    unique: true
});
// Add pre-remove middleware
menusSchema.pre('remove', async function(next) {
    try {
        // Delete all related orders
        const Orders = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders');
        await Orders.deleteMany({
            MenuId: this._id
        });
        next();
    } catch (error) {
        next(error);
    }
});
// Add pre-deleteMany middleware
menusSchema.pre('deleteMany', async function(next) {
    try {
        // Get the menus that will be deleted
        const Menus = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Menus');
        const menus = await Menus.find(this.getFilter());
        // Get all menu IDs
        const menuIds = menus.map((menu)=>menu._id);
        // Delete all related orders
        if (menuIds.length > 0) {
            const Orders = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders');
            await Orders.deleteMany({
                MenuId: {
                    $in: menuIds
                }
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Menus || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Menus", menusSchema);
}}),
"[project]/src/app/lib/crud/Menus.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Menus.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Dishes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Dishes.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
;
;
;
class MenusCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async createMenu(data) {
        try {
            const normalizedData = {
                HotelId: data.hotel_id,
                SectionId: data.section_id,
                DishId: data.dish_id,
                Price: data.price
            };
            // Create the menu
            const menuResult = await this.create(normalizedData);
            if (menuResult.returncode === 200) {
                // Update the dish's Menus array
                const dish = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Dishes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(data.dish_id, {
                    $push: {
                        Menus: menuResult.output._id
                    }
                }, {
                    new: true
                });
                if (!dish) {
                    return {
                        returncode: 404,
                        message: "Dish not found",
                        output: []
                    };
                }
                return menuResult;
            }
            return menuResult;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readMenus(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    },
                    {
                        path: 'SectionId'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readMenusBySectionId(section_id) {
        try {
            const result = await this.readMany({
                SectionId: section_id
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Takeaway
    async readTakeawayMenus() {
        try {
            const result = await this.readMany({
                "SectionId.Type": "Takeaway"
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Delivery
    async readDeliveryMenus() {
        try {
            const result = await this.readMany({
                "SectionId.Type": "Delivery"
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Swiggy
    async readSwiggyMenus() {
        try {
            const result = await this.readMany({
                "SectionId.Type": "Swiggy"
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // Zomto
    async readZomatoMenus() {
        try {
            const result = await this.readMany({
                "SectionId.Type": "Zomato"
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    // QR Menus
    async readQRMenus() {
        try {
            const result = await this.readMany({
                "SectionId.Type": "QR-Orders"
            }, {
                populate: [
                    {
                        path: 'DishId',
                        populate: [
                            {
                                path: 'CategoryId'
                            }
                        ]
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateMenu(menu_id, data) {
        try {
            const updateData = {
                Price: data.price
            };
            const result = await this.update({
                _id: menu_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteMenus(filter) {
        try {
            // First get the menus to be deleted
            const menusToDelete = await this.readMany(filter);
            if (menusToDelete.returncode === 200 && menusToDelete.output.length > 0) {
                // Finally delete the menus
                const result = await this.delete(filter);
                return result;
            }
            return {
                returncode: 404,
                message: "No menus found to delete",
                output: []
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteMenuById(menu_id) {
        try {
            const menu = await this.readOne({
                _id: menu_id
            });
            if (menu.returncode === 200) {
                // Finally delete the menu
                const result = await this.delete({
                    _id: menu_id
                });
                return result;
            }
            return {
                returncode: 404,
                message: "No menus found",
                output: []
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async doesMenuExists(section_id, dish_id) {
        try {
            const result = await this.readMany({
                SectionId: section_id,
                DishId: dish_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateMenuAvailability(menu_id, is_available) {
        try {
            const result = await this.update({
                _id: menu_id
            }, {
                IsAvailable: is_available
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateMenuPrice(menu_id, price) {
        try {
            const result = await this.update({
                _id: menu_id
            }, {
                Price: price
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readMenusByDish(dish_id) {
        try {
            const result = await this.readMany({
                DishId: dish_id
            }, {
                populate: [
                    {
                        path: 'SectionId'
                    },
                    {
                        path: 'Menu'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async moveMenusBetweenSections(from_section_id, to_section_id) {
        try {
            // Check if any menus have active orders
            const menusWithOrders = await this.readMany({
                SectionId: from_section_id
            }, {
                populate: [
                    {
                        path: 'Menu',
                        match: {
                            Status: {
                                $in: [
                                    'Ordered',
                                    'Preparing'
                                ]
                            }
                        }
                    }
                ]
            });
            if (menusWithOrders.returncode === 200) {
                const activeMenus = menusWithOrders.output.filter((menu)=>menu.Menu && menu.Menu.length > 0);
                if (activeMenus.length > 0) {
                    return {
                        returncode: 400,
                        message: "Cannot move menus with active orders",
                        output: []
                    };
                }
            }
            const result = await this.update({
                SectionId: from_section_id
            }, {
                SectionId: to_section_id
            }, {
                new: true,
                multi: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async getMenuStats(menu_id) {
        try {
            const result = await this.readOne({
                _id: menu_id
            }, {
                populate: [
                    {
                        path: 'Menu',
                        select: 'Quantity TotalAmount Status CreatedAt'
                    }
                ]
            });
            if (result.returncode === 200) {
                const orders = result.output.Menu || [];
                const stats = {
                    totalOrders: orders.length,
                    totalQuantity: orders.reduce((sum, order)=>sum + order.Quantity, 0),
                    totalRevenue: orders.reduce((sum, order)=>sum + order.TotalAmount, 0),
                    ordersByStatus: orders.reduce((acc, order)=>{
                        acc[order.Status] = (acc[order.Status] || 0) + 1;
                        return acc;
                    }, {}),
                    averageOrderValue: orders.length ? orders.reduce((sum, order)=>sum + order.TotalAmount, 0) / orders.length : 0
                };
                return {
                    returncode: 200,
                    message: "Menu stats retrieved successfully",
                    output: stats
                };
            }
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const menusCrud = new MenusCrud();
const __TURBOPACK__default__export__ = menusCrud;
}}),
"[project]/src/app/lib/crud/Dishes.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Dishes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Dishes.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Menus.js [app-route] (ecmascript)");
;
;
;
class DishesCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Dishes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async createDish(data) {
        try {
            const normalized_data = {
                DishName: data.dish_name,
                Code: data.code,
                Description: data.description,
                Type: data.type,
                CategoryId: data.category_id,
                HotelId: data.hotel_id
            };
            const result = await this.create(normalized_data);
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readDishes(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async doesDishExists(hotel_id, dish_name, code) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id,
                DishName: dish_name,
                Code: code
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateDishInfo(data) {
        try {
            const updateData = {
                DishName: data.dish_name,
                Code: data.code,
                Description: data.description,
                Type: data.type
            };
            const dish_id = data.dish_id;
            const result = await this.update({
                _id: dish_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteDishesByCategoryId(category_id) {
        try {
            const deleteResult = await this.delete({
                CategoryId: category_id
            });
            return deleteResult;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteDishesById(dish_id) {
        try {
            const deleteResult = await this.delete({
                _id: dish_id
            });
            return deleteResult;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteDishes(filter) {
        try {
            const deleteResult = await this.delete(filter);
            return deleteResult;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const dishesCrud = new DishesCrud();
const __TURBOPACK__default__export__ = dishesCrud;
}}),
"[project]/src/app/lib/crud/MenuCategory.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$MenuCategory$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/MenuCategory.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Dishes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Dishes.js [app-route] (ecmascript)");
;
;
;
class MenuCategoryCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$MenuCategory$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async createMenuCategory(data) {
        try {
            const normalizedData = {
                CategoryName: data.category_name,
                HotelId: data.hotel_id
            };
            const result = await this.create(normalizedData);
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateMenuCategory(data) {
        try {
            const updateData = {
                CategoryName: data.category_name
            };
            const result = await this.update({
                _id: data.category_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readMenuCategories(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async doesMenuCategoryExists(hotel_id, category_name) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id,
                CategoryName: category_name
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteCategoriesById(category_id) {
        try {
            // Delete all related data
            const deleteResult = await this.delete({
                _id: category_id
            });
            if (deleteResult.returncode === 200) {
                return {
                    returncode: 200,
                    message: "Menu Categories and all related data deleted successfully",
                    output: []
                };
            }
            return deleteResult;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const menuCategoriesCrud = new MenuCategoryCrud();
const __TURBOPACK__default__export__ = menuCategoriesCrud;
}}),
"[project]/src/app/lib/models/Orders.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__),
    "ordersSchema": (()=>ordersSchema)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_import__("[externals]/ [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$FloatValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/FloatValidator.js [app-route] (ecmascript)");
;
;
const ordersSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema({
    Quantity: {
        type: Number,
        required: true,
        min: [
            1,
            'Quantity must be at least 1'
        ],
        validate: {
            validator: function(value) {
                return !isNaN(value) && (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$FloatValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value);
            },
            message: (props)=>`${props.value} is not a valid quantity. Quantity must be a positive number.`
        }
    },
    Note: {
        type: String,
        default: null
    },
    TotalAmount: {
        type: Number,
        required: true,
        validate: {
            validator: (value)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$FloatValidator$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(value)
        },
        message: "Total Amount must be a non-negative number."
    },
    MenuId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Menus",
        required: true
    },
    BillId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Bills",
        required: true
    },
    Status: {
        type: String,
        default: "Ordered",
        validate: {
            validator: (value)=>{
                return [
                    "Ordered",
                    "Done",
                    "Accepted",
                    "Rejected",
                    "Cancelled"
                ].includes(value);
            }
        },
        message: "Status must be one of: 'Ordered', 'Done', 'Accepted', 'Rejected', 'Cancelled'."
    },
    Reason: {
        type: String,
        default: null
    },
    HotelId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Schema.Types.ObjectId,
        ref: "Hotels",
        required: true
    }
}, {
    timestamps: true
});
// Pre-remove middleware for single document
ordersSchema.pre('deleteOne', {
    document: true
}, async function(next) {
    try {
        // Update menu if needed
        if (this.MenuId) {
            const Menus = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Menus');
            await Menus.findByIdAndUpdate(this.MenuId, {
                $pull: {
                    Orders: this._id
                }
            });
        }
        // Update bill if needed
        if (this.BillId) {
            const Bills = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Bills');
            await Bills.findByIdAndUpdate(this.BillId, {
                $pull: {
                    Orders: this._id
                }
            });
        }
        next();
    } catch (error) {
        next(error);
    }
});
// Pre-deleteMany middleware for multiple documents
ordersSchema.pre('deleteMany', async function(next) {
    try {
        const Orders = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Orders');
        const orders = await Orders.find(this.getFilter());
        if (orders.length > 0) {
            const menuIds = orders.map((order)=>order.MenuId).filter(Boolean);
            if (menuIds.length > 0) {
                const Menus = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model('Menus');
                await Menus.updateMany({
                    _id: {
                        $in: menuIds
                    }
                }, {
                    $pull: {
                        Orders: {
                            $in: orders.map((order)=>order._id)
                        }
                    }
                });
            }
        }
        next();
    } catch (error) {
        next(error);
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Orders || __TURBOPACK__imported__module__$5b$externals$5d2f$__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Orders", ordersSchema);
}}),
"[project]/src/app/lib/crud/Orders.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Orders$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Orders.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Bills.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Menus.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
;
;
;
;
class OrdersCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Orders$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async addOrder(data) {
        try {
            const normalizedData = {
                Quantity: data.quantity,
                Note: data.note,
                TotalAmount: data.total_amount,
                MenuId: data.menu_id,
                BillId: data.bill_id,
                Status: data?.status || "Ordered",
                HotelId: data.hotel_id
            };
            // Check if the menu exists in the bill
            const menu_exists = await this.readOne({
                MenuId: data.menu_id,
                BillId: data.bill_id
            });
            if (menu_exists && menu_exists.returncode === 200 && menu_exists.output) {
                // Update existing order
                const old_quantity = menu_exists.output.Quantity || 0;
                const old_total = menu_exists.output.TotalAmount || 0;
                const quantity = old_quantity + data.quantity;
                const total_amount = old_total + data.total_amount;
                const orderResult = await this.update({
                    _id: menu_exists.output._id
                }, {
                    Quantity: quantity,
                    TotalAmount: total_amount,
                    Status: data.status || "Ordered"
                }, {
                    new: true
                });
                return orderResult;
            } else {
                // Create new order
                const orderResult = await this.create(normalizedData);
                if (orderResult.returncode === 200 && orderResult.output) {
                    try {
                        // Update Bill with new order
                        await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(data.bill_id, {
                            $push: {
                                Orders: orderResult.output._id
                            }
                        }, {
                            new: true
                        });
                        // Update Menu with new order
                        await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(data.menu_id, {
                            $push: {
                                Menu: orderResult.output._id
                            }
                        }, {
                            new: true
                        });
                        return orderResult;
                    } catch (error) {
                        console.error('Error updating references:', error);
                        return {
                            returncode: 500,
                            message: "Failed to update bill or menu references",
                            output: null
                        };
                    }
                }
                return orderResult;
            }
        } catch (error) {
            console.error('Error in addOrder:', error);
            return {
                returncode: 500,
                message: error.message || "Failed to add order",
                output: null
            };
        }
    }
    async readOrders(bill_id) {
        try {
            const result = await this.readMany({
                BillId: bill_id
            }, {
                populate: [
                    {
                        path: 'MenuId',
                        populate: {
                            path: 'DishId'
                        }
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateOrderStatus(order_id, status) {
        try {
            const result = await this.update({
                _id: order_id
            }, {
                Status: status
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async cancelOrder(order_id, reason) {
        try {
            const result = await this.update({
                _id: order_id
            }, {
                Reason: reason,
                Status: "Cancelled"
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async undoCancelOrder(order_id, status) {
        try {
            const result = await this.update({
                _id: order_id
            }, {
                Status: status,
                Reason: null
            }, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteOrders(filter) {
        try {
            // First get the orders to be deleted
            const ordersToDelete = await this.readMany(filter);
            if (ordersToDelete.returncode === 200 && ordersToDelete.output.length > 0) {
                const orderIds = ordersToDelete.output.map((order)=>order._id);
                // Use Promise.all to run updates in parallel
                await Promise.all([
                    // Remove order references from bills
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].updateMany({
                        Orders: {
                            $in: orderIds
                        }
                    }, {
                        $pull: {
                            Orders: {
                                $in: orderIds
                            }
                        }
                    }),
                    // Remove order references from menus
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].updateMany({
                        Menu: {
                            $in: orderIds
                        }
                    }, {
                        $pull: {
                            Menu: {
                                $in: orderIds
                            }
                        }
                    })
                ]);
                // Finally delete the orders
                const result = await this.delete(filter);
                return result;
            }
            return {
                returncode: 404,
                message: "No orders found to delete",
                output: []
            };
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async orderExists(menu_id, bill_id) {
        try {
            const result = await this.readOne({
                MenuId: menu_id,
                BillId: bill_id
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async SyncOrder({ Quantity, Note, TotalAmount, MenuId, bill_id, Status, HotelId }) {
        try {
            // Create new order
            const orderResult = await this.create({
                Quantity: Quantity,
                Note: Note,
                TotalAmount: TotalAmount,
                MenuId: MenuId,
                BillId: bill_id,
                Status: Status,
                HotelId: HotelId
            });
            if (orderResult.returncode === 200 && orderResult.output) {
                try {
                    // Update Bill with new order
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(bill_id, {
                        $push: {
                            Orders: orderResult.output._id
                        }
                    }, {
                        new: true
                    });
                    return orderResult;
                } catch (error) {
                    console.error('Error updating references:', error);
                    return {
                        returncode: 500,
                        message: "Failed to update bill or menu references",
                        output: null
                    };
                }
            }
            return orderResult;
        } catch (error) {
            console.error('Error in addOrder:', error);
            return {
                returncode: 500,
                message: error.message || "Failed to add order",
                output: null
            };
        }
    }
}
const ordersCrud = new OrdersCrud();
const __TURBOPACK__default__export__ = ordersCrud;
}}),
"[project]/src/app/lib/crud/Tables.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/BaseCrud.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Tables.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/models/Bills.js [app-route] (ecmascript)");
;
;
;
class TablesCrud extends __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$BaseCrud$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BaseCrud"] {
    constructor(){
        super(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"]);
    }
    async createTable(data) {
        try {
            const normalizedData = {
                TableName: data.table_name,
                PersonsOccupiable: data.persons_occupiable,
                Status: "Open",
                HotelId: data.hotel_id,
                SectionId: data.section_id
            };
            const result = await this.create(normalizedData);
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readTables(hotel_id) {
        try {
            const result = await this.readMany({
                HotelId: hotel_id
            }, {
                populate: [
                    {
                        path: 'SectionId',
                        select: 'SectionName Type'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readTable(table_id) {
        try {
            const result = await this.readOne({
                _id: table_id
            }, {
                populate: [
                    {
                        path: 'SectionId',
                        select: 'SectionName Type'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async readTablesBySection(section_id) {
        try {
            const result = await this.readMany({
                SectionId: section_id
            }, {
                populate: [
                    {
                        path: 'SectionId',
                        select: 'SectionName Type Floor'
                    }
                ]
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateTableInfo(data) {
        try {
            const updateData = {
                TableName: data.table_name,
                Capacity: data.capacity
            };
            const result = await this.update({
                _id: data.table_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateTableStatus(data) {
        try {
            // If setting to occupied, check if there are any open bills
            if (data.status === "Occupied") {
                const openBills = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOne({
                    TableId: data.table_id,
                    Status: "Open"
                });
                if (!openBills) {
                    return {
                        returncode: 400,
                        message: "Cannot occupy table without an open bill",
                        output: []
                    };
                }
            }
            const updateData = {
                Status: data.status
            };
            const result = await this.update({
                _id: data.table_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async updateTableSection(data) {
        try {
            // Check if table has any open bills before moving to new section
            const openBills = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOne({
                TableId: data.table_id,
                Status: "Open"
            });
            if (openBills) {
                return {
                    returncode: 400,
                    message: "Cannot move table with open bills to a new section",
                    output: []
                };
            }
            const updateData = {
                SectionId: data.section_id
            };
            const result = await this.update({
                _id: data.table_id
            }, updateData, {
                new: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async moveTablesBetweenSections(from_section_id, to_section_id) {
        try {
            // Check if any tables in the section have open bills
            const tablesWithBills = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOne({
                Status: "Open",
                TableId: {
                    $in: (await this.readMany({
                        SectionId: from_section_id
                    })).output.map((t)=>t._id)
                }
            });
            if (tablesWithBills) {
                return {
                    returncode: 400,
                    message: "Cannot move tables with open bills to a new section",
                    output: []
                };
            }
            const result = await this.update({
                SectionId: from_section_id
            }, {
                SectionId: to_section_id
            }, {
                new: true,
                multi: true
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async deleteTables(filter) {
        try {
            // Check if any tables are currently in use
            const tables = await this.readMany(filter);
            if (tables.returncode === 200) {
                for (const table of tables.output){
                    const openBills = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$models$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOne({
                        TableId: table._id,
                        Status: "Open"
                    });
                    if (openBills) {
                        return {
                            returncode: 400,
                            message: `Table ${table.TableName} has open bills and cannot be deleted`,
                            output: []
                        };
                    }
                }
                // If no open bills, proceed with deletion
                const result = await this.delete(filter);
                return result;
            }
            return tables;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
    async doesTableExists(hotel_id, table_name) {
        try {
            const result = await this.readOne({
                HotelId: hotel_id,
                TableName: table_name
            });
            return result;
        } catch (error) {
            return {
                returncode: 500,
                message: error.message,
                output: []
            };
        }
    }
}
const tablesCrud = new TablesCrud();
const __TURBOPACK__default__export__ = tablesCrud;
}}),
"[project]/src/app/api/hotel/bill_order/dine_in/controller.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "dine_in_bill_fetch": (()=>dine_in_bill_fetch)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Bills.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$MenuCategory$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/MenuCategory.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Menus.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Orders$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Orders.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/crud/Tables.js [app-route] (ecmascript)");
;
;
;
;
;
async function dine_in_bill_fetch(data, tokenData) {
    try {
        const hotel_id = await tokenData.hotelId;
        const table_id = data['table_id'] || null;
        if (hotel_id === null || table_id === null) {
            return {
                returncode: 400,
                message: "Required Parameters not found.",
                output: []
            };
        }
        // Table
        const table_info = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Tables$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readTable(table_id);
        if (table_info.returncode === 200) {
            const section_id = table_info.output.SectionId;
            // Existing Bill
            const existing_bill = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Bills$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].dineInRead(table_id);
            let fetched_orders;
            if (existing_bill.returncode === 200 || existing_bill.output.length != 0) {
                //Orders
                const orders = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Orders$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readOrders(existing_bill?.output._id);
                if (orders.returncode == 200 || orders.output.length != 0) {
                    fetched_orders = orders.output;
                }
            }
            // Menu
            const menus = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$Menus$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readMenusBySectionId(section_id);
            //Categories
            const categories = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$crud$2f$MenuCategory$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].readMenuCategories(hotel_id);
            const bill_output = existing_bill.output;
            return {
                returncode: 200,
                message: "Dine-In Bill Fetched for the table.",
                output: [
                    {
                        ExistingBill: bill_output,
                        Menus: menus.output,
                        Categories: categories.output,
                        Orders: fetched_orders,
                        TableInfo: table_info.output
                    }
                ]
            };
        }
        return table_info;
    } catch (error) {
        return {
            returncode: 500,
            message: error.message,
            output: []
        };
    }
}
}}),
"[externals]/ [external] (buffer, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("buffer");

module.exports = mod;
}}),
"[externals]/ [external] (stream, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("stream");

module.exports = mod;
}}),
"[externals]/ [external] (util, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("util");

module.exports = mod;
}}),
"[externals]/ [external] (crypto, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("crypto");

module.exports = mod;
}}),
"[project]/src/app/lib/utils/jwt.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "createToken": (()=>createToken),
    "decodeToken": (()=>decodeToken),
    "updateToken": (()=>updateToken),
    "verifyToken": (()=>verifyToken)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jsonwebtoken/index.js [app-route] (ecmascript)");
;
const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key'; // In production, always use environment variable
const JWT_EXPIRES_IN = '24h';
const createToken = (payload)=>{
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].sign(payload, JWT_SECRET, {
        expiresIn: JWT_EXPIRES_IN
    });
};
const verifyToken = (token)=>{
    try {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].verify(token, JWT_SECRET);
    } catch (error) {
        return null;
    }
};
const updateToken = (token, newData)=>{
    try {
        const decoded = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].verify(token, JWT_SECRET);
        const updatedPayload = {
            ...decoded,
            ...newData
        };
        // Remove the exp claim to generate a fresh expiration
        delete updatedPayload.exp;
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].sign(updatedPayload, JWT_SECRET, {
            expiresIn: JWT_EXPIRES_IN
        });
    } catch (error) {
        return null;
    }
};
const decodeToken = (token)=>{
    try {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].decode(token);
    } catch (error) {
        return null;
    }
};
}}),
"[project]/src/app/api/hotel/bill_order/dine_in/route.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$hotel$2f$bill_order$2f$dine_in$2f$controller$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/api/hotel/bill_order/dine_in/controller.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$jwt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/utils/jwt.js [app-route] (ecmascript)");
;
;
;
async function POST(request) {
    try {
        // Get token from cookie
        const token = request.cookies.get('hotel_auth_token')?.value;
        if (!token) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                returncode: 401,
                message: "No token provided",
                output: []
            }, {
                status: 401,
                statusText: "No token provided"
            });
        }
        // Verify the token
        const userData = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$utils$2f$jwt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyToken"])(token);
        if (!userData) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                returncode: 401,
                message: "Invalid or expired token",
                output: []
            }, {
                status: 401,
                statusText: "Invalid or expired token"
            });
        }
        const data = await request.json();
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$hotel$2f$bill_order$2f$dine_in$2f$controller$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["dine_in_bill_fetch"])(data, userData);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            returncode: result.returncode,
            message: result.message,
            output: result.output
        }, {
            status: result.returncode
        });
    } catch (error) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            returncode: 500,
            message: error.message,
            output: []
        }, {
            status: 500
        });
    }
}
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: require } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__4a79d3._.js.map